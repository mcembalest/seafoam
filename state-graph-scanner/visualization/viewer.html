<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>State-Action Graph Explorer</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.6/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 300px;
            background: #252525;
            border-right: 1px solid #3a3a3a;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #3a3a3a;
        }

        .sidebar-header h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            color: #888;
        }

        .stats {
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
            font-size: 13px;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .stat-value {
            color: #4CAF50;
            font-weight: 600;
        }

        .search-box {
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
        }

        .search-box input {
            width: 100%;
            padding: 8px 12px;
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 4px;
            color: #e0e0e0;
            font-size: 13px;
        }

        .search-box input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .filters {
            padding: 15px 20px;
            border-bottom: 1px solid #3a3a3a;
        }

        .filter-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .filter-option input {
            margin-right: 8px;
        }

        .details {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: #888;
            margin-bottom: 8px;
        }

        .detail-content {
            font-size: 13px;
            line-height: 1.6;
        }

        .label-badge {
            display: inline-block;
            padding: 3px 8px;
            background: #3a3a3a;
            border-radius: 3px;
            font-size: 11px;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .graph-container {
            flex: 1;
            position: relative;
        }

        #graph {
            width: 100%;
            height: 100%;
        }

        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(37, 37, 37, 0.95);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
            font-size: 12px;
        }

        .legend-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(37, 37, 37, 0.95);
            border: 1px solid #3a3a3a;
            color: #e0e0e0;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
        }

        .control-btn:hover {
            background: #3a3a3a;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>Graph Explorer</h1>
                <p id="graph-name">Loading...</p>
            </div>

            <div class="stats">
                <div class="stat">
                    <span>States</span>
                    <span class="stat-value" id="state-count">0</span>
                </div>
                <div class="stat">
                    <span>Actions</span>
                    <span class="stat-value" id="action-count">0</span>
                </div>
                <div class="stat">
                    <span>Transitions</span>
                    <span class="stat-value" id="transition-count">0</span>
                </div>
            </div>

            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search states, actions..." />
            </div>

            <div class="filters">
                <div class="filter-title">Show States</div>
                <div class="filter-option">
                    <input type="checkbox" id="show-modal" checked />
                    <label for="show-modal">Modal States</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="show-data" checked />
                    <label for="show-data">Data States</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="show-ready" checked />
                    <label for="show-ready">Ready States</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="show-other" checked />
                    <label for="show-other">Other States</label>
                </div>
            </div>

            <div class="details" id="details">
                <div class="empty-state">
                    Click on a state or action to view details
                </div>
            </div>
        </div>

        <div class="graph-container">
            <div id="graph"></div>

            <div class="legend">
                <div class="legend-title">Legend</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2196F3;"></div>
                    <span>Modal States</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4CAF50;"></div>
                    <span>Ready States</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #FF9800;"></div>
                    <span>Data States</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9C27B0;"></div>
                    <span>Initial State</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #757575;"></div>
                    <span>Other States</span>
                </div>
            </div>

            <div class="controls">
                <button class="control-btn" onclick="fitGraph()">Fit View</button>
                <button class="control-btn" onclick="resetZoom()">Reset Zoom</button>
                <button class="control-btn" onclick="togglePhysics()">Toggle Physics</button>
            </div>
        </div>
    </div>

    <script src="graph-data.js"></script>
    <script>
        let network;
        let allNodes = [];
        let allEdges = [];
        let physicsEnabled = true;

        // Initialize graph
        function initGraph() {
            const container = document.getElementById('graph');

            // Process nodes
            const nodes = graphData.graph.states.map(state => {
                const node = {
                    id: state.id,
                    label: state.id.length > 30 ? state.id.substring(0, 27) + '...' : state.id,
                    title: state.labels.slice(0, 3).join(', '),
                    data: state,
                    shape: 'box',
                    margin: 10,
                    font: {
                        color: '#ffffff',
                        size: 12
                    }
                };

                // Color by category
                if (state.id === 'initial') {
                    node.color = {background: '#9C27B0', border: '#7B1FA2'};
                } else if (state.id.includes('modal')) {
                    node.color = {background: '#2196F3', border: '#1976D2'};
                    node.category = 'modal';
                } else if (state.id.includes('ready')) {
                    node.color = {background: '#4CAF50', border: '#388E3C'};
                    node.category = 'ready';
                } else if (state.id.includes('empty') || state.id.includes('present')) {
                    node.color = {background: '#FF9800', border: '#F57C00'};
                    node.category = 'data';
                } else {
                    node.color = {background: '#757575', border: '#616161'};
                    node.category = 'other';
                }

                return node;
            });

            // Process edges
            const edges = graphData.graph.transitions.map(t => ({
                from: t.from,
                to: t.to,
                label: '', // Too cluttered with labels
                arrows: 'to',
                color: {color: '#555', highlight: '#4CAF50'},
                width: 1,
                smooth: {type: 'cubicBezier'},
                data: t
            }));

            allNodes = nodes;
            allEdges = edges;

            const data = {
                nodes: new vis.DataSet(nodes),
                edges: new vis.DataSet(edges)
            };

            const options = {
                nodes: {
                    borderWidth: 2,
                    borderWidthSelected: 3
                },
                edges: {
                    smooth: {
                        type: 'cubicBezier',
                        forceDirection: 'horizontal'
                    }
                },
                physics: {
                    enabled: true,
                    solver: 'forceAtlas2Based',
                    forceAtlas2Based: {
                        gravitationalConstant: -50,
                        centralGravity: 0.01,
                        springLength: 100,
                        springConstant: 0.08
                    },
                    stabilization: {
                        iterations: 150
                    }
                },
                interaction: {
                    hover: true,
                    tooltipDelay: 100
                },
                layout: {
                    hierarchical: {
                        enabled: false
                    }
                }
            };

            network = new vis.Network(container, data, options);

            // Update stats
            document.getElementById('state-count').textContent = graphData.graph.states.length;
            document.getElementById('action-count').textContent = graphData.graph.actions.length;
            document.getElementById('transition-count').textContent = graphData.graph.transitions.length;
            document.getElementById('graph-name').textContent = 'State-Action Graph';

            // Event handlers
            network.on('click', function(params) {
                if (params.nodes.length > 0) {
                    showNodeDetails(params.nodes[0]);
                } else if (params.edges.length > 0) {
                    showEdgeDetails(params.edges[0]);
                }
            });

            // Search
            document.getElementById('search-input').addEventListener('input', handleSearch);

            // Filters
            document.getElementById('show-modal').addEventListener('change', applyFilters);
            document.getElementById('show-data').addEventListener('change', applyFilters);
            document.getElementById('show-ready').addEventListener('change', applyFilters);
            document.getElementById('show-other').addEventListener('change', applyFilters);
        }

        function showNodeDetails(nodeId) {
            const node = allNodes.find(n => n.id === nodeId);
            if (!node) return;

            const state = node.data;
            const incoming = allEdges.filter(e => e.to === nodeId);
            const outgoing = allEdges.filter(e => e.from === nodeId);

            document.getElementById('details').innerHTML = `
                <div class="detail-section">
                    <div class="detail-title">State</div>
                    <div class="detail-content"><strong>${state.id}</strong></div>
                </div>
                <div class="detail-section">
                    <div class="detail-title">Labels</div>
                    <div class="detail-content">
                        ${state.labels.map(l => `<span class="label-badge">${l}</span>`).join('')}
                    </div>
                </div>
                <div class="detail-section">
                    <div class="detail-title">Transitions</div>
                    <div class="detail-content">
                        Incoming: ${incoming.length}<br>
                        Outgoing: ${outgoing.length}
                    </div>
                </div>
            `;
        }

        function showEdgeDetails(edgeId) {
            const edge = allEdges.find(e => e.id === edgeId);
            if (!edge) return;

            const transition = edge.data;
            const action = graphData.graph.actions.find(a => a.id === transition.via);

            document.getElementById('details').innerHTML = `
                <div class="detail-section">
                    <div class="detail-title">Transition</div>
                    <div class="detail-content">
                        <strong>${transition.from}</strong><br>
                        â†“ ${action ? action.labels[0] : transition.via}<br>
                        <strong>${transition.to}</strong>
                    </div>
                </div>
                ${action ? `
                <div class="detail-section">
                    <div class="detail-title">Action Labels</div>
                    <div class="detail-content">
                        ${action.labels.slice(0, 5).map(l => `<span class="label-badge">${l}</span>`).join('')}
                    </div>
                </div>
                ` : ''}
            `;
        }

        function handleSearch(e) {
            const query = e.target.value.toLowerCase();
            if (!query) {
                network.unselectAll();
                return;
            }

            const matchingNodes = allNodes.filter(n =>
                n.id.toLowerCase().includes(query) ||
                n.data.labels.some(l => l.toLowerCase().includes(query))
            );

            if (matchingNodes.length > 0) {
                network.selectNodes(matchingNodes.map(n => n.id));
                network.focus(matchingNodes[0].id, {scale: 1.5});
            }
        }

        function applyFilters() {
            const showModal = document.getElementById('show-modal').checked;
            const showData = document.getElementById('show-data').checked;
            const showReady = document.getElementById('show-ready').checked;
            const showOther = document.getElementById('show-other').checked;

            const nodesToShow = allNodes.filter(n => {
                if (n.id === 'initial') return true;
                if (n.category === 'modal' && !showModal) return false;
                if (n.category === 'data' && !showData) return false;
                if (n.category === 'ready' && !showReady) return false;
                if (n.category === 'other' && !showOther) return false;
                return true;
            });

            const nodeIds = new Set(nodesToShow.map(n => n.id));
            const edgesToShow = allEdges.filter(e =>
                nodeIds.has(e.from) && nodeIds.has(e.to)
            );

            network.setData({
                nodes: new vis.DataSet(nodesToShow),
                edges: new vis.DataSet(edgesToShow)
            });
        }

        function fitGraph() {
            network.fit();
        }

        function resetZoom() {
            network.moveTo({scale: 1});
        }

        function togglePhysics() {
            physicsEnabled = !physicsEnabled;
            network.setOptions({physics: {enabled: physicsEnabled}});
        }

        // Initialize on load
        window.addEventListener('load', initGraph);
    </script>
</body>
</html>
