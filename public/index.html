<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seafoam</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
    <script>
      // Pre-apply UI CSS variables before styles to minimize CLS
      (function(){
        try {
          var root = document.documentElement.style;
          var h = localStorage.getItem('libraryHeight') || localStorage.getItem('savedPanelHeight');
          if (h) root.setProperty('--library-height', h);
          var cards = null;
          try { cards = JSON.parse(localStorage.getItem('cardsLayout') || 'null'); } catch(_) {}
          if (cards) {
            var c = cards.composition || {}, o = cards.output || {};
            function px(v){return (typeof v === 'number' && !isNaN(v)) ? (v + 'px') : null;}
            var cx = px(c.x), cy = px(c.y), cw = px(c.w), ch = px(c.h);
            var ox = px(o.x), oy = px(o.y), ow = px(o.w), oh = px(o.h);
            if (cx) root.setProperty('--comp-x', cx);
            if (cy) root.setProperty('--comp-y', cy);
            if (cw) root.setProperty('--comp-w', cw);
            if (ch) root.setProperty('--comp-h', ch);
            if (ox) root.setProperty('--out-x', ox);
            if (oy) root.setProperty('--out-y', oy);
            if (ow) root.setProperty('--out-w', ow);
            if (oh) root.setProperty('--out-h', oh);
          }
        } catch (e) {}
      })();
    </script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div style="display: flex; align-items: center; gap: 12px; height: 64px;">
                <img src="assets/Seafoam.png" alt="Seafoam" class="logo" style="width: 64px; height: 64px;">
                <h1>Seafoam</h1>
                <span id="server-status" class="status-pill status-offline" title="Backend connection status">Offline</span>
            </div>
            <div style="margin-top: 8px; display:flex; gap:8px; align-items:center;">
                <label for="bg-input" style="font-size:12px; color:#5f6368;">Background</label>
                <input id="bg-input" type="file" accept="image/*" style="font-size:12px;">
            </div>
        </header>

        <div id="library-panel" class="filesystem-section library-panel">
                <div id="panel-grabber" class="panel-grabber" aria-label="Resize saved panel"></div>
                <div class="panel-body">
                    <div class="view-toggle" id="saved-view-toggle" style="display:flex; gap:8px; justify-content:flex-end; margin-bottom:8px;">
                        <button class="toggle-btn active" data-mode="grid" title="Icons view">Icons</button>
                        <button class="toggle-btn" data-mode="list" title="List view">List</button>
                    </div>
                    <div class="saved-images">
                        <h3>Saved Images</h3>
                        <div id="saved-images-grid" class="saved-grid"></div>
                        <input type="file" id="add-image" accept="image/*" multiple style="display: none;">
                        <button id="add-image-btn" class="add-btn">+ Upload New Image</button>
                    </div>
                    <div class="saved-texts">
                        <h3>Saved Instructions</h3>
                        <div id="saved-texts-list" class="saved-list"></div>
                        <button id="add-text-btn" class="add-btn">+ Write New Instruction</button>
                    </div>
                </div>
        </div>
        

        <div class="main-content">
            <div id="canvas" class="canvas">
            
            <div class="composition-section canvas-card" data-card="composition">
                <div class="card-header card-drag-handle">Composer</div>
                <div class="composition-area">
                    
                    <div class="form-group">
                        <p>Instructions</p>
                        <textarea id="composition-text" placeholder="Write your instructions here (or drag saved instructions from your library)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <p>Images</p>
                        <p>Upload here (or drag saved images from your library)</p>
                        <div id="image-slots" class="image-slots">
                            
                            <div class="image-slot" data-slot="0">
                                <span>Image</span>
                            </div>
                            <div class="image-slot" data-slot="1">
                                <span>Image</span>
                            </div>
                            <div class="image-slot" data-slot="2">
                                <span>Image</span>
                            </div>
                        </div>
                        <input type="file" id="slot-file-input" accept="image/*" style="display: none;">
                    </div>

                    <div class="action-buttons">
                        <button id="preview-btn" class="preview-btn">Preview Prompt</button>
                        <button id="generate-btn" class="generate-btn">
                            <span class="btn-text">Generate</span>
                            <span class="btn-loading" style="display: none;">Generating...</span>
                        </button>
                    </div>
                </div>
                <div class="card-resize-handle" data-card="composition"></div>
            </div>

            <div class="output-section canvas-card" data-card="output">
                <div class="card-header card-drag-handle">Output</div>
                <div class="result-container">
                    <div id="image-placeholder" class="image-placeholder">
                        <div class="placeholder-content">
                            <span>üñºÔ∏è</span>
                            <p>Images will appear here</p>
                        </div>
                    </div>
                    <div id="image-result" class="image-result" style="display: none;">
                        <img id="generated-image" alt="Generated image">
                        <div class="image-actions">
                            <button id="download-btn" class="action-btn">Download</button>
                            <button id="save-btn" class="action-btn">Save</button>
                        </div>
                    </div>
                </div>
                <div class="card-resize-handle" data-card="output"></div>
            </div>
            
            </div>
        </div>

        <button id="drawer-toggle" class="drawer-toggle" aria-label="Toggle Image + Instruction Library">Image + Instruction Library ‚ñ≤</button>

        <div id="preview-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>Gemini API Preview</h3>
                <div class="preview-content">
                    <div class="form-group">
                        <label>Request JSON:</label>
                        <pre id="preview-json" class="code-block"></pre>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="modal-cancel">Cancel</button>
                </div>
            </div>
        </div>

        <div id="text-input-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <h3>Write Instruction</h3>
                <div class="form-group" style="margin-bottom:10px;">
                    <label for="new-text-title">Title</label>
                    <input id="new-text-title" type="text" placeholder="Enter a title (optional)" />
                </div>
                <div class="form-group">
                    <label for="new-text-input">Instruction</label>
                    <textarea id="new-text-input" placeholder="Enter your instruction..."></textarea>
                </div>
                <div class="modal-actions">
                    <button id="text-cancel">Cancel</button>
                    <button id="text-save">Save</button>
                </div>
            </div>
        </div>

        <div id="text-editor-modal" class="modal" style="display:none;">
            <div class="modal-content" style="max-width:720px;">
                <h3>Edit Text Instruction</h3>
                <div class="form-group">
                    <label>Name</label>
                    <input id="edit-text-name" type="text" />
                </div>
                <div class="form-group">
                    <label>Text</label>
                    <textarea id="edit-text-body" rows="8"></textarea>
                </div>
                <div class="modal-actions">
                    <button id="edit-text-cancel">Cancel</button>
                    <button id="edit-text-save" class="generate-btn">Save</button>
                </div>
            </div>
        </div>

        <div id="image-editor-modal" class="modal" style="display:none;">
            <div class="modal-content" style="max-width:900px;">
                <h3>Edit Image</h3>
                <div class="form-group">
                    <label>Name</label>
                    <input id="edit-image-name" type="text" />
                </div>
                <div class="form-group">
                    <label>Caption</label>
                    <textarea id="edit-image-caption" rows="3" placeholder="Optional caption shown after image"></textarea>
                </div>
                <div class="form-group">
                    <label>Image</label>
                    <div style="display:flex; gap:12px; align-items:flex-start;">
                        <div style="position:relative; border:1px solid #e0e0e0;">
                            <canvas id="edit-image-canvas" width="480" height="320" style="max-width:100%; background:#111;"></canvas>
                            <div id="crop-overlay" style="position:absolute; border:2px dashed #00bcd4; display:none; pointer-events:none;"></div>
                        </div>
                        <div style="display:flex; flex-direction:column; gap:8px;">
                            <input id="replace-image-input" type="file" accept="image/*" style="display:none;" />
                            <button id="replace-image-btn">Replace Image</button>
                            <button id="crop-toggle-btn">Crop</button>
                            <button id="crop-apply-btn" style="display:none;">Apply</button>
                            <button id="crop-cancel-btn" style="display:none;">Cancel</button>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="edit-image-cancel">Cancel</button>
                    <button id="edit-image-save" class="generate-btn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
